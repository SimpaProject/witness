function init(e,t){nodes=e,edges=t,firstUnit=nodes[0].rowid,lastUnit=nodes[nodes.length-1].rowid,phantoms={},phantomsTop={},notStable=[],nextPositionUpdates=null,generateOffset=0,newOffset=-116,notLastUnitUp=!1,notLastUnitDown=!0,activeNode=null,waitGo=null,createCy(),generate(e,t),oldOffset=_cy.getElementById(nodes[0].data.unit).position().y+66,_cy.viewport({zoom:1}),_cy.center(_cy.nodes()[0]),page="dag",location.hash&&45==location.hash.length&&(notLastUnitUp=!0,highlightNode(location.hash.substr(1))),isInit=!0}function start(){!location.hash||45!=location.hash.length&&33!=location.hash.length?socket.emit("start",{type:"last"}):45==location.hash.length?(socket.emit("start",{type:"unit",unit:location.hash.substr(1)}),notLastUnitUp=!0):33==location.hash.length&&(socket.emit("start",{type:"address",address:location.hash.substr(1)}),$("#addressInfo").show())}function createCy(){_cy=cytoscape({container:document.getElementById("cy"),boxSelectionEnabled:!1,autounselectify:!0,hideEdgesOnViewport:!1,layout:{name:"preset"},style:[{selector:"node",style:{content:"data(unit_s)","text-opacity":1,"min-zoomed-font-size":13,"text-valign":"bottom","text-halign":"center","font-size":"13px","text-margin-y":"5px","background-color":"#fff","border-width":1,"border-color":"#2980b9",width:25,height:25}},{selector:"node.hover",style:{content:"data(id)","text-opacity":1,"font-weight":"bold","font-size":"14px","text-background-color":"#fff","text-background-opacity":1,"text-background-shape":"rectangle","text-border-opacity":1,"text-border-width":4,"text-border-color":"#fff","z-index":9999}},{selector:"edge",style:{width:2,"target-arrow-shape":"triangle","line-color":"#2980b9","target-arrow-color":"#2980b9","curve-style":"bezier"}},{selector:".best_parent_unit",style:{width:5,"target-arrow-shape":"triangle","line-color":"#2980b9","target-arrow-color":"#2980b9","curve-style":"bezier"}},{selector:".is_on_main_chain",style:{"background-color":"#9cc0da"}},{selector:".is_stable",style:{"border-width":4,"border-style":"solid","border-color":"#2980b9"}},{selector:".active",style:{"border-color":"#333","border-width":"4"}},{selector:".finalBad",style:{"background-color":"red"}},{selector:".tempBad",style:{"background-color":"red"}}],elements:{nodes:[],edges:[]}}),_cy.on("mouseover","node",function(){this.addClass("hover")}),_cy.on("mouseout","node",function(){this.removeClass("hover")}),_cy.on("click","node",function(e){location.hash="#"+e.cyTarget.id()}),_cy.on("tap","node",function(e){location.hash="#"+e.cyTarget.id()}),_cy.on("pan",function(){var e=_cy.extent();nextPositionUpdates<e.y2?getNext():!0===notLastUnitUp&&e.y2-e.h<_cy.getElementById(nodes[0].data.unit).position().y&&getPrev(),scroll.scrollTop(convertPosPanToPosScroll())}),$(_cy.container()).on("wheel mousewheel",function(e){var t=e.originalEvent.wheelDeltaY||-e.originalEvent.deltaY;"dag"==page&&(e.preventDefault(),t>0?scrollUp():t<0&&_cy.panBy({x:0,y:-25}),scroll.scrollTop(convertPosPanToPosScroll()))})}function updListNotStableUnit(){_cy&&(notStable=[],_cy.nodes().forEach(function(e){e.hasClass("is_stable")||notStable.push(e.id())}))}function generate(e,t){var n,s,a,o,i=1/0,d=-1/0,r=!1,l=[],c="",h=createGraph(e,t);h.nodes().forEach(function(e){(a=h.node(e))&&(a.x<i&&(i=a.x),a.x>d&&(d=a.x))}),h.nodes().forEach(function(e){(a=h.node(e))&&(c="",a.is_on_main_chain&&(c+="is_on_main_chain "),a.is_stable&&(c+="is_stable "),"final-bad"===a.sequence&&(c+="finalBad"),"temp-bad"===a.sequence&&(c+="tempBad"),r||(n=-a.x-(d-i)/2,s=generateOffset-a.y+66,r=!0),void 0!==phantoms[e]?(_cy.remove(_cy.getElementById(e)),l.push({group:"nodes",data:{id:e,unit_s:a.label},position:{x:phantoms[e],y:a.y+s},classes:c}),delete phantoms[e]):(o=setMaxWidthNodes(a.x+n),0==o&&0==a.is_on_main_chain&&(o+=40),l.push({group:"nodes",data:{id:e,unit_s:a.label},position:{x:o,y:a.y+s},classes:c})))}),l=fixConflicts(l),_cy.add(l),generateOffset=_cy.nodes()[_cy.nodes().length-1].position().y,nextPositionUpdates=generateOffset,_cy.add(createEdges()),updListNotStableUnit(),updateScrollHeigth()}function animationPanUp(e){animationPlaysPanUp?queueAnimationPanUp.push(e):(queueAnimationPanUp.length>1&&(e=queueAnimationPanUp.reduce(function(e,t){return e+t}),queueAnimationPanUp=[]),_cy.stop(),animationPlaysPanUp=!0,_cy.animate({pan:{x:_cy.pan("x"),y:_cy.pan("y")+e}},{duration:250,complete:function(){oldOffset=_cy.getElementById(nodes[0].data.unit).position().y+66,animationPlaysPanUp=!1,queueAnimationPanUp.length&&(animationPanUp(queueAnimationPanUp[0]),queueAnimationPanUp.splice(0,1))}}))}function setNew(e,t,n){var s,a,o,i,d,r=1/0,l=-1/0,c=1/0,h=-1/0,p=!1,u=[],g="",f=createGraph(e,t);f.nodes().forEach(function(e){(i=f.node(e))&&(o=i.y,o<r&&(r=o),o>l&&(l=o),i.x<c&&(c=i.x),i.x>h&&(h=i.x))}),f.nodes().forEach(function(e){(i=f.node(e))&&(g="",i.is_on_main_chain&&(g+="is_on_main_chain "),i.is_stable&&(g+="is_stable "),"final-bad"===i.sequence&&(g+="finalBad"),"temp-bad"===i.sequence&&(g+="tempBad"),p||(s=-i.x-(h-c)/2,a=newOffset-(l-r)+66,newOffset-=l-r+66,p=!0,n&&_cy.extent().y1<oldOffset&&animationPanUp(l+54)),void 0!==phantomsTop[e]?(_cy.remove(_cy.getElementById(e)),u.push({group:"nodes",data:{id:e,unit_s:i.label},position:{x:phantomsTop[e],y:i.y+a},classes:g}),delete phantomsTop[e]):(d=setMaxWidthNodes(i.x+s),0==d&&0==i.is_on_main_chain&&(d+=40),u.push({group:"nodes",data:{id:e,unit_s:i.label},position:{x:d,y:i.y+a},classes:g})))}),u=fixConflicts(u),_cy.add(u),_cy.add(createEdges()),updListNotStableUnit(),updateScrollHeigth()}function createGraph(e,t){var n=new dagre.graphlib.Graph({multigraph:!0,compound:!0});n.setGraph({}),n.setDefaultEdgeLabel(function(){return{}}),e.forEach(function(e){n.setNode(e.data.unit,{label:e.data.unit_s,width:32,height:32,is_on_main_chain:e.is_on_main_chain,is_stable:e.is_stable,sequence:e.sequence})});for(var s in t)t.hasOwnProperty(s)&&n.setEdge(t[s].data.source,t[s].data.target);return dagre.layout(n),n}function setMaxWidthNodes(e){return e>500?e/(e/500):e<-500?-e/(e/500):e}function fixConflicts(e){var t,n,s,a,o={};for(t=0,s=e.length;t<s;t++)for(n=0;n<s;n++)t!=n&&e[t].position.x<e[n].position.x+10&&e[t].position.x>e[n].position.x-10&&e[t].position.y==e[n].position.y&&(o[e[t].position.y]||(o[e[t].position.y]=[]),o[e[t].position.y].push(e[t]));for(var i in o){var d=0,r=[];for(n=0,a=o[i].length;n<a;n++)for(t=0;t<s;t++)e[t].data.id==o[i][n].data.id&&-1==r.indexOf(e[t].data.id)&&(r.push(e[t].data.id),e[t].position.x<0?d-=60:d+=60,e[t].position.x+=d)}return e}function createEdges(){for(var e,t,n=cloneObj(edges),s=_cy.edges(),a=s.length,o=[],i=0,d=0,r="",l=0,c=a;l<c;l++)e=s[l].source()+"_"+s[l].target(),n[e]&&delete n[e];for(e in phantoms)_cy.getElementById(e).position("y",generateOffset+166);for(e in phantomsTop)_cy.getElementById(e).position("y",newOffset-166);for(e in n)n.hasOwnProperty(e)&&(r="",r+=n[e].best_parent_unit?"best_parent_unit":"",_cy.getElementById(n[e].data.target).length?o.push({group:"edges",data:n[e].data,classes:r}):(t=_cy.getElementById(n[e].data.source).position(),phantoms[n[e].data.target]=t.x+i,o.push({group:"nodes",data:{id:n[e].data.target,unit_s:n[e].data.target.substr(0,7)+"..."},position:{x:t.x+i,y:generateOffset+166}}),i+=60,o.push({group:"edges",data:n[e].data,classes:r})),_cy.getElementById(n[e].data.source).length||(t=_cy.getElementById(n[e].data.target).position(),phantomsTop[n[e].data.source]=t.x+d,o.push({group:"nodes",data:{id:n[e].data.source,unit_s:n[e].data.source.substr(0,7)+"..."},position:{x:t.x+d,y:newOffset-166}}),d+=60,o.push({group:"edges",data:n[e].data,classes:r})));return o}function setChangesStableUnits(e){if(e){var t;e.forEach(function(e){t=_cy.getElementById(e.unit),t&&(t.hasClass("is_stable")||t.addClass("is_stable"),1!==e.is_on_main_chain||t.hasClass("is_on_main_chain")?0===e.is_on_main_chain&&t.hasClass("is_on_main_chain")&&t.removeClass("is_on_main_chain"):t.addClass("is_on_main_chain")),notStable.splice(notStable.indexOf(e.unit),1)}),updListNotStableUnit()}}function cloneObj(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function highlightNode(e){_cy||createCy(),activeNode&&_cy.getElementById(activeNode).removeClass("active");var t=_cy.getElementById(e);if(t.length&&void 0===phantoms[e]&&void 0===phantomsTop[e]){var n=_cy.extent(),s=t.position().y;lastActiveUnit=location.hash.substr(1),t.addClass("active"),activeNode=t.id(),socket.emit("info",{unit:activeNode}),(s<n.y1||s>n.y2)&&(bWaitingForPrev=!0,_cy.stop(),_cy.animate({pan:{x:_cy.pan("x"),y:_cy.getCenterPan(t).y},complete:function(){bWaitingForPrev=!1}},{duration:250})),page="dag"}else waitGo=e,getHighlightNode(waitGo);return!1}function scrollUp(){var e=_cy.extent();!1===notLastUnitUp&&e.y2-e.h/2>_cy.getElementById(nodes[0].data.unit).position().y+20||!0===notLastUnitUp&&e.y2-e.h>_cy.getElementById(nodes[0].data.unit).position().y?_cy.panBy({x:0,y:25}):!0===notLastUnitUp&&getPrev()}function showHideBlock(e,t){var n,s=$("#"+t);n=e.target.classList.contains("infoTitle")?$(e.target):$(e.target.parentNode),"none"===s.css("display")?(s.show(250),n.removeClass("hideTitle")):(s.hide(250),n.addClass("hideTitle"))}function searchForm(e){44==e.length||32==e.length?location.hash=e:showInfoMessage("Please enter a unit or address"),$("#inputSearch").val("")}function goToTop(){if(notLastUnitUp)socket.emit("start",{type:"last"});else{var e=_cy.getElementById(nodes[0].data.unit);_cy.stop(),_cy.animate({pan:{x:_cy.pan("x"),y:_cy.getCenterPan(e).y}},{duration:400})}location.hash="",activeNode&&_cy.getElementById(activeNode).removeClass("active"),$("#info").hasClass("hideInfoBlock")||$("#info").addClass("hideInfoBlock"),$("#cy").hasClass("showInfoBlock")&&$("#cy, #scroll").removeClass("showInfoBlock"),$("#defaultInfo").show(),$("#listInfo").hide()}function resetViewport(){_cy.viewport({zoom:1})}function generateMessageInfo(e,t,n,s){var a,o,i="",d=0,r=!1;return e.forEach(function(e){if(e.payload&&"{}"!==e.payload){switch(o=e.payload.asset||"null",i+='<div class="message"><div class="message_app infoTitleChild" onclick="showHideBlock(event, \'message_'+d+"')\">","payment"==e.app?i+=e.app.substr(0,1).toUpperCase()+e.app.substr(1)+" in "+("null"==o?"DAG":o):"asset"==e.app?i+="Definition of new asset":i+=e.app.substr(0,1).toUpperCase()+e.app.substr(1),i+='</div><div class="messagesInfo" id="message_'+d+++'">',e.app){case"payment":e.payload&&(i+='<div class="message_inputs"><div class="infoTitleInputs" onclick="showHideBlock(event, \'message_'+d+'\')">Inputs</div><div class="inputsInfo" id="message_'+d+++'">',e.payload.inputs.forEach(function(e){if(e.type&&"issue"==e.type)i+='<div class="infoTitleInput" onclick="showHideBlock(event, \'message_'+d+'\')">Issue</div><div class="inputInfo" id="message_'+d+++'"><div>Serial number: '+e.serial_number+'</div><div>Amount: <span class="numberFormat">'+e.amount+"</span></div></div>";else if(void 0!==e.output_index)a=e.unit+"_"+e.output_index+"_"+o,i+='<div><span class="numberFormat">'+t[a].amount+'</span> from <a href="#'+t[a].unit+'">'+t[a].unit+"</a></div>";else if("headers_commission"===e.type||"witnessing"===e.type){a=e.from_main_chain_index+"_"+e.to_main_chain_index;var n="headers_commission"===e.type?"headers":"witnessing"===e.type&&"witnessing";n&&(i+='<div><span class="numberFormat">'+s[n][a].sum+"</span> DAGs of "+n+' commissions on <a href="#'+s[n][a].address+'">'+s[n][a].address+"</a> from mci "+s[n][a].from_mci+" to mci "+s[n][a].to_mci+"</div>")}}),i+='</div></div><div class="message_outputs"><div class="infoTitleInputs" onclick="showHideBlock(event, \'message_'+d+'\')">Outputs</div><div class="inputsInf" id="message_'+d+++'">',n[o].forEach(function(e){i+='<div class="outputs_div">',e.is_spent?i+='<div><span class="numberFormat">'+e.amount+'</span> to <a href="#'+e.address+'">'+e.address+'</a><br> (spent in <a href="#'+e.spent+'">'+e.spent+"</a>)</div>":i+='<div><span class="numberFormat">'+e.amount+'</span> to <a href="#'+e.address+'">'+e.address+"</a><br> (not spent)</div>",i+="</div>"}),i+="</div></div>");break;case"text":"{}"!==e.payload&&(i+="<div>Text: "+htmlEscape(e.payload)+"</div>");break;default:for(var l in e.payload)"asset"==e.app&&"denominations"==l?(i+="<div>denominations:</div><div>",i+=JSON.stringify(e.payload[l]),i+="</div>"):"object"==typeof e.payload[l]?(i+="<div>"+htmlEscape(l)+":</div><div>",i+=htmlEscape(JSON.stringify(e.payload[l])),i+="</div>"):i+="<div>"+htmlEscape(l+": "+e.payload[l])+"</div>"}i+="</div></div>"}else"payment"!=e.app||"none"!=e.payload_location||r||(i+='<div class="message childNotSpoiler">Hidden payments</div>',r=!0)}),i}function generateTransactionsList(e,t){var n,s,a,o="";for(var i in e){n=e[i],o+='<tr><th class="transactionUnit" colspan="2" align="left"><div>Unit <a href="#'+n.unit+'">'+n.unit+'</a></div></th><th class="transactionUnit" colspan="1" align="right"><div style="font-weight: normal">'+moment(n.date).format("DD.MM.YYYY HH:mm:ss")+'</div></th></tr><tr><th colspan="3"><div style="margin: 5px"></div></th></tr><tr><td>',n.from.forEach(function(e){if(e.issue)o+='<div class="transactionUnitListAddress"><div>'+s+'</div><div>Issue <span class="numberFormat">'+e.amount+"</span> "+n.asset+"</div><div>serial number: "+e.serial_number+"</div></div>";else if(!e.commissionType||"headers"!==e.commissionType&&"witnessing"!==e.commissionType)s=e.address==t?'<span class="thisAddress">'+e.address+"</span>":'<a href="#'+e.address+'">'+e.address+"</a>",o+='<div class="transactionUnitListAddress"><div>'+s+'</div><div>(<span class="numberFormat">'+e.amount+"</span> "+(null==n.asset?"DAGs":n.asset)+")</div></div>";else{var a="headers"===e.commissionType?"headers":"witnessing"===e.commissionType&&"witnessing";a&&(s=e.address==t?'<span class="thisAddress">'+e.address+"</span>":'<a href="#'+e.address+'">'+e.address+"</a>",o+='<div class="transactionUnitListAddress"><div>'+s+" "+a+" commissions from mci "+e.from_mci+" to mci "+e.to_mci+'. Sum: <span class="numberFormat">'+e.sum+"</span> DAGs</div></div>")}}),o+='</td><td><img width="32" src="'+(n.spent?"/img/red_right2.png":"/img/green_right2.png")+'"></td><td>';for(var i in n.to)a=n.to[i],s=a.address==t?'<span class="thisAddress">'+a.address+"</span>":'<a href="#'+a.address+'">'+a.address+"</a>",o+='<div class="transactionUnitListAddress"><div>'+s+'</div><div>(<span class="numberFormat">'+a.amount+"</span> "+(null==n.asset?"DAGs":n.asset)+", "+(0===a.spent?"not spent":'spent in <a href="#'+a.spent+'">'+a.spent+"</a>")+")</div></div>";o+='</td></tr><tr><th colspan="3"><div style="margin: 10px"></div></th></tr>'}return o}function getNew(){notLastUnitUp||(bWaitingForNew?bHaveDelayedNewRequests=!0:(socket.emit("new",{unit:firstUnit,notStable:notStable}),bWaitingForNew=!0))}function getNext(){!bWaitingForNext&&isInit&&(socket.emit("next",{last:lastUnit,notStable:notStable}),bWaitingForNext=!0)}function getPrev(){!bWaitingForPrev&&isInit&&(socket.emit("prev",{first:firstUnit,notStable:notStable}),bWaitingForPrev=!0)}function getHighlightNode(e){bWaitingForHighlightNode||(socket.emit("highlightNode",{first:firstUnit,last:lastUnit,unit:e}),bWaitingForHighlightNode=!0)}function getNextPageTransactions(){bWaitingForNextPageTransactions||33!=location.hash.length||(socket.emit("nextPageTransactions",{address:location.hash.substr(1),lastInputsROWID:lastInputsROWID,lastOutputsROWID:lastOutputsROWID}),bWaitingForNextPageTransactions=!0)}function adaptiveShowInfo(){$("#cy, #scroll, #goToTop").addClass("showInfoBlock"),$("#info").removeClass("hideInfoBlock")}function closeInfo(){$("#info").addClass("hideInfoBlock"),$("#cy, #scroll, #goToTop").removeClass("showInfoBlock")}function closeAddress(){$("#addressInfo").hide(),$("#blockListUnspent").hide(),_cy&&lastActiveUnit?location.hash=lastActiveUnit:($("#cy, #scroll, #goToTop").show(),socket.emit("start",{type:"last"}),location.hash=""),page="dag"}function showInfoMessage(e,t){t||(t=3e3),timerInfoMessage&&clearTimeout(timerInfoMessage),$("#infoMessage").html(e).show(350),timerInfoMessage=setTimeout(function(){$("#infoMessage").hide(350).html("")},t)}function hideInfoMessage(){timerInfoMessage&&clearTimeout(timerInfoMessage),$("#infoMessage").hide(350).html("")}function updateScrollHeigth(){var e=_cy.getCenterPan(_cy.getElementById(nodes[0].data.unit)).y,t=_cy.getCenterPan(_cy.getElementById(nodes[nodes.length-1].data.unit)).y;scrollTopPos=convertPosPanToPosScroll(e,0),scrollLowPos=convertPosPanToPosScroll(t)+scroll.height()+116,$("#scrollBody").height(convertPosPanToPosScroll(t-e,0)+scroll.height()/2),setTimeout(function(){scroll.scrollTop(convertPosPanToPosScroll())},1)}function convertPosScrollToPosPan(e){return e||(e=scroll.scrollTop()),scroll.height()/2-scrollTopPos-e}function convertPosPanToPosScroll(e,t){return e||(e=_cy.pan("y")),void 0===t&&(t=scrollTopPos),scroll.height()/2-t-e}function numberFormat(e){return e=1e-6*parseInt(e),e=Math.round(1e8*e)/1e8,e=e.toString(),e.replace(new RegExp("^(\\d{"+(e.length%3?e.length%3:0)+"})(\\d{3})","g"),"$1$2").replace(/(\d{3})+?/gi,"$1").trim()}function formatAllNumbers(){var e=$(".numberFormat").not(".format");$.each(e,function(t,n){$(e[t]).addClass("format").html(numberFormat(n.innerHTML))})}function htmlEscape(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}var _cy,nodes,edges,firstUnit,lastUnit,phantoms={},phantomsTop={},notStable=[],nextPositionUpdates,generateOffset=0,newOffset=-116,oldOffset,activeNode,waitGo,notLastUnitUp=!1,notLastUnitDown=!0,lastActiveUnit,page,isInit=!1,queueAnimationPanUp=[],animationPlaysPanUp=!1;window.addEventListener("hashchange",function(){45==location.hash.length?(highlightNode(location.hash.substr(1)),"block"==$("#addressInfo").css("display")&&$("#addressInfo").hide()):33==location.hash.length&&socket.emit("start",{type:"address",address:location.hash.substr(1)})}),window.addEventListener("keydown",function(e){"dag"==page&&(38==e.keyCode?(e.preventDefault(),scrollUp()):40==e.keyCode&&(e.preventDefault(),_cy.panBy({x:0,y:-25})))},!0),$(window).scroll(function(){$(window).scrollTop()+$(window).height()+200>=$(document).height()&&(nextPageTransactionsEnd||getNextPageTransactions())});var socket=io.connect(location.href),bWaitingForNext=!1,bWaitingForNew=!1,bHaveDelayedNewRequests=!1,bWaitingForPrev=!1,bWaitingForHighlightNode=!1,bWaitingForNextPageTransactions=!1,nextPageTransactionsEnd=!1,lastInputsROWID=0,lastOutputsROWID=0;socket.on("connect",function(){start()}),socket.on("start",function(e){init(e.nodes,e.edges),e.not_found&&showInfoMessage("Unit not found"),notLastUnitDown=!0,bWaitingForHighlightNode&&(bWaitingForHighlightNode=!1)}),socket.on("next",function(e){if(notLastUnitDown){bWaitingForHighlightNode&&(bWaitingForHighlightNode=!1),nodes=nodes.concat(e.nodes);for(var t in e.edges)e.edges.hasOwnProperty(t)&&(edges[t]=e.edges[t]);lastUnit=nodes[nodes.length-1].rowid,generate(e.nodes,e.edges),bWaitingForNext=!1,waitGo&&(highlightNode(waitGo),waitGo=!1),0===e.nodes.length&&(notLastUnitDown=!1),setChangesStableUnits(e.arrStableUnits)}}),socket.on("prev",function(e){if(bWaitingForHighlightNode&&(bWaitingForHighlightNode=!1),e.nodes.length){nodes=[].concat(e.nodes,nodes);for(var t in e.edges)e.edges.hasOwnProperty(t)&&(edges[t]=e.edges[t]);firstUnit=e.nodes[0].rowid,setNew(e.nodes,e.edges)}bWaitingForPrev=!1,!0===e.end&&(notLastUnitUp=!1),waitGo&&(highlightNode(waitGo),waitGo=!1),setChangesStableUnits(e.arrStableUnits)}),socket.on("info",function(e){if(bWaitingForHighlightNode&&(bWaitingForHighlightNode=!1),e){var t="",n="",s="",a="";e.child.forEach(function(e){t+='<div><a href="#'+e+'">'+e+"</a></div>"}),e.parents.forEach(function(e){n+='<div><a href="#'+e+'">'+e+"</a></div>"});var o=0;e.authors.forEach(function(e){s+='<div><a href="#'+e.address+'">'+e.address+"</a>",e.definition&&(s+='<span class="infoTitle hideTitle" class="definitionTitle" onclick="showHideBlock(event, \'definition'+o+'\')">Definition<div class="infoTitleImg"></div></span><div id="definition'+o+++'" style="display: none"><pre>'+JSON.stringify(JSON.parse(e.definition),null,"   ")+"</pre></div>"),s+="</div>"}),e.witnesses.forEach(function(e){a+='<div><a href="#'+e+'">'+e+"</a></div>"}),$("#unit").html(e.unit),$("#children").html(t),$("#parents").html(n),$("#authors").html(s),$("#received").html(moment(e.date).format("DD.MM.YYYY HH:mm:ss")),$("#fees").html('<span class="numberFormat">'+(parseInt(e.headers_commission)+parseInt(e.payload_commission))+'</span> (<span class="numberFormat">'+e.headers_commission+'</span> headers, <span class="numberFormat">'+e.payload_commission+"</span> payload)"),$("#last_ball_unit").html('<a href="#'+e.last_ball_unit+'">'+e.last_ball_unit+"</a>"),$("#level").html(e.level),$("#witnessed_level").html(e.witnessed_level),$("#main_chain_index").html(e.main_chain_index),$("#latest_included_mc_index").html(e.latest_included_mc_index),$("#is_stable").html(e.is_stable),$("#witnesses").html(a),$("#messages").html("final-bad"===e.sequence?"":generateMessageInfo(e.messages,e.transfersInfo,e.outputsUnit,e.assocCommissions)),"none"===$("#listInfo").css("display")&&($("#defaultInfo").hide(),$("#listInfo").show()),"final-bad"===e.sequence?$("#divTitleMessage,#divFees").hide():$("#divTitleMessage,#divFees").show(),adaptiveShowInfo(),formatAllNumbers()}else showInfoMessage("Unit not found")}),socket.on("update",getNew),socket.on("new",function(e){if(e.nodes.length){nodes=[].concat(e.nodes,nodes);for(var t in e.edges)e.edges.hasOwnProperty(t)&&(edges[t]=e.edges[t]);firstUnit=nodes[0].rowid,setNew(e.nodes,e.edges,!0),bHaveDelayedNewRequests&&(bHaveDelayedNewRequests=!1,getNew()),e.nodes.length>=100&&(notLastUnitUp=!0)}bWaitingForNew=!1,setChangesStableUnits(e.arrStableUnits)}),socket.on("addressInfo",function(e){if(e){var t="",n="";lastInputsROWID=e.newLastInputsROWID,lastOutputsROWID=e.newLastOutputsROWID,nextPageTransactionsEnd=e.end;for(var s in e.objBalance)n+="bytes"===s?'<div><span class="numberFormat">'+e.objBalance[s]+"</span> DAGs</div>":'<div><span class="numberFormat">'+e.objBalance[s]+"</span> of "+s+"</div>";e.unspent&&e.unspent.forEach(function(e){t+='<div><a href="#'+e.unit+'">'+e.unit+'</a> (<span class="numberFormat">'+e.amount+"</span> "+(null==e.asset?"DAGs":e.asset)+")</div>"}),$("#address").html(e.address),$("#balance").html(n),$("#listUnspent").html(t);var a=generateTransactionsList(e.objTransactions,e.address);a?($("#listUnits").html(a),$("#titleListTransactions").show()):($("#listUnits").html(""),$("#titleListTransactions").hide()),""!==t?$("#blockListUnspent").show():$("#blockListUnspent").hide(),"none"==$("#addressInfo").css("display")&&$("#addressInfo").show(),e.definition?($("#definitionTitleInAddress").show(),$("#definition").html("<pre>"+JSON.stringify(JSON.parse(e.definition),null,"   ")+"</pre>")):($("#definition").hide(),$("#definitionTitleInAddress").hasClass("hideTitle")||$("#definitionTitleInAddress").addClass("hideTitle"),$("#definitionTitleInAddress").hide()),page="address",formatAllNumbers()}else showInfoMessage("Address not found");bWaitingForNextPageTransactions=!1,!nextPageTransactionsEnd&&$("#tableListTransactions").height()<$(window).height()&&getNextPageTransactions()}),socket.on("nextPageTransactions",function(e){e&&(e.newLastOutputsROWID&&e.newLastOutputsROWID&&(lastInputsROWID=e.newLastInputsROWID,lastOutputsROWID=e.newLastOutputsROWID),nextPageTransactionsEnd=e.end,$("#listUnits").append(generateTransactionsList(e.objTransactions,e.address)),formatAllNumbers()),bWaitingForNextPageTransactions=!1,!nextPageTransactionsEnd&&$("#tableListTransactions").height()<$(window).height()&&getNextPageTransactions()});var timerInfoMessage,scroll=$("#scroll"),scrollTopPos=0,scrollLowPos;scroll.scroll(function(e){e.preventDefault(),_cy.pan("y",convertPosScrollToPosPan())}),$(window).resize(function(){_cy&&scroll.scrollTop(convertPosPanToPosScroll())});